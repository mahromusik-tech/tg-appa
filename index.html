<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TON Empire</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-color: var(--tg-theme-bg-color, #1c1c1e);
            --text-color: var(--tg-theme-text-color, #ffffff);
            --secondary-bg: var(--tg-theme-secondary-bg-color, #2c2c2e);
            --accent: var(--tg-theme-button-color, #007aff);
            --accent-text: var(--tg-theme-button-text-color, #ffffff);
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            margin: 0;
            padding: 0;
            user-select: none;
            -webkit-user-select: none;
            padding-bottom: 80px; /* –ú–µ—Å—Ç–æ –¥–ª—è –º–µ–Ω—é */
        }

        /* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å —Ä–µ—Å—É—Ä—Å–æ–≤ */
        .header {
            position: sticky;
            top: 0;
            background-color: var(--bg-color);
            padding: 15px;
            display: flex;
            justify-content: space-around;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            z-index: 10;
        }

        .res-item {
            text-align: center;
        }
        .res-value { font-size: 18px; font-weight: bold; }
        .res-label { font-size: 12px; opacity: 0.7; }

        /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç */
        .container { padding: 15px; }

        .card {
            background-color: var(--secondary-bg);
            border-radius: 14px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .building-icon { font-size: 32px; margin-right: 15px; }
        .building-info { flex-grow: 1; }
        .building-name { font-weight: bold; font-size: 16px; }
        .building-desc { font-size: 13px; opacity: 0.7; margin-top: 4px; }
        
        .buy-btn {
            background-color: var(--accent);
            color: var(--accent-text);
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
        }
        .buy-btn:disabled { opacity: 0.5; cursor: not-allowed; }

        /* –ì–ª–∞–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –∫–ª–∏–∫–∞ */
        .clicker-area {
            text-align: center;
            margin: 30px 0;
        }
        .main-btn {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: radial-gradient(circle, var(--accent) 0%, #0056b3 100%);
            border: 4px solid rgba(255,255,255,0.2);
            font-size: 40px;
            cursor: pointer;
            box-shadow: 0 0 20px rgba(0,122,255,0.4);
            transition: transform 0.1s;
        }
        .main-btn:active { transform: scale(0.95); }

        /* –ù–∏–∂–Ω–µ–µ –º–µ–Ω—é */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: var(--secondary-bg);
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        .nav-item {
            text-align: center;
            font-size: 12px;
            opacity: 0.6;
            cursor: pointer;
        }
        .nav-item.active { opacity: 1; color: var(--accent); }
        .nav-icon { font-size: 24px; display: block; margin-bottom: 4px; }

        /* –≠–∫—Ä–∞–Ω—ã */
        .screen { display: none; }
        .screen.active { display: block; }

    </style>
</head>
<body>

    <!-- –†–µ—Å—É—Ä—Å—ã -->
    <div class="header">
        <div class="res-item">
            <div class="res-value" id="gold">0</div>
            <div class="res-label">–ó–æ–ª–æ—Ç–æ</div>
        </div>
        <div class="res-item">
            <div class="res-value" id="income">0/—Å–µ–∫</div>
            <div class="res-label">–î–æ—Ö–æ–¥</div>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω: –ë–ê–ó–ê -->
    <div id="screen-base" class="screen active container">
        <div class="clicker-area">
            <button class="main-btn" onclick="clickMine()">‚õèÔ∏è</button>
            <p>–ù–∞–∂–º–∏, —á—Ç–æ–±—ã –¥–æ–±—ã—Ç—å</p>
        </div>

        <h3>–¢–≤–æ–∏ –ø–æ—Å—Ç—Ä–æ–π–∫–∏</h3>
        <div id="buildings-list">
            <!-- –°—é–¥–∞ —Å–∫—Ä–∏–ø—Ç –¥–æ–±–∞–≤–∏—Ç –∑–¥–∞–Ω–∏—è -->
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω: –ú–ê–ì–ê–ó–ò–ù -->
    <div id="screen-shop" class="screen container">
        <h3>–ú–∞–≥–∞–∑–∏–Ω —É–ª—É—á—à–µ–Ω–∏–π</h3>
        <div id="shop-list">
            <!-- –°—é–¥–∞ —Å–∫—Ä–∏–ø—Ç –¥–æ–±–∞–≤–∏—Ç —Ç–æ–≤–∞—Ä—ã -->
        </div>
    </div>

    <!-- –ù–∏–∂–Ω–µ–µ –º–µ–Ω—é -->
    <div class="bottom-nav">
        <div class="nav-item active" onclick="switchScreen('base', this)">
            <span class="nav-icon">üè∞</span>–ë–∞–∑–∞
        </div>
        <div class="nav-item" onclick="switchScreen('shop', this)">
            <span class="nav-icon">üõí</span>–ú–∞–≥–∞–∑–∏–Ω
        </div>
        <div class="nav-item" onclick="alert('–°–∫–æ—Ä–æ!')">
            <span class="nav-icon">‚öîÔ∏è</span>–ê—Ä–º–∏—è
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // --- –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ò–ì–†–´ ---
        const gameConfig = {
            buildings: [
                { id: 'mine', name: '–ó–æ–ª–æ—Ç–∞—è —à–∞—Ö—Ç–∞', icon: '‚õèÔ∏è', baseCost: 50, income: 1 },
                { id: 'farm', name: '–§–µ—Ä–º–∞', icon: 'üåæ', baseCost: 200, income: 5 },
                { id: 'factory', name: '–ó–∞–≤–æ–¥', icon: 'üè≠', baseCost: 1000, income: 30 }
            ]
        };

        // --- –°–û–°–¢–û–Ø–ù–ò–ï (State) ---
        let state = {
            gold: 0,
            buildings: { mine: 0, farm: 0, factory: 0 },
            lastSave: Date.now()
        };

        // --- –ó–ê–ì–†–£–ó–ö–ê / –°–û–•–†–ê–ù–ï–ù–ò–ï ---
        function loadGame() {
            const saved = localStorage.getItem('ton_strategy_save');
            if (saved) {
                state = JSON.parse(saved);
            }
            // –ù–∞—á–∏—Å–ª—è–µ–º –∑–æ–ª–æ—Ç–æ –∑–∞ –≤—Ä–µ–º—è –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è (AFK)
            const now = Date.now();
            const secondsOffline = (now - state.lastSave) / 1000;
            const income = calculateIncome();
            if (secondsOffline > 10 && income > 0) {
                const earned = Math.floor(secondsOffline * income);
                state.gold += earned;
                tg.showAlert(`–ü–æ–∫–∞ —Ç–µ–±—è –Ω–µ –±—ã–ª–æ, —Ä–∞–±–æ—á–∏–µ –¥–æ–±—ã–ª–∏ ${earned} –∑–æ–ª–æ—Ç–∞!`);
            }
            updateUI();
        }

        function saveGame() {
            state.lastSave = Date.now();
            localStorage.setItem('ton_strategy_save', JSON.stringify(state));
        }

        // --- –õ–û–ì–ò–ö–ê ---
        function calculateIncome() {
            let income = 0;
            gameConfig.buildings.forEach(b => {
                income += (state.buildings[b.id] || 0) * b.income;
            });
            return income;
        }

        function getCost(buildingId) {
            const b = gameConfig.buildings.find(x => x.id === buildingId);
            const count = state.buildings[buildingId];
            // –¶–µ–Ω–∞ —Ä–∞—Å—Ç–µ—Ç –Ω–∞ 15% —Å –∫–∞–∂–¥–æ–π –ø–æ–∫—É–ø–∫–æ–π
            return Math.floor(b.baseCost * Math.pow(1.15, count));
        }

        function clickMine() {
            state.gold += 1 + calculateIncome(); // –ö–ª–∏–∫ –¥–∞–µ—Ç 1 + –¥–æ—Ö–æ–¥ –≤ —Å–µ–∫—É–Ω–¥—É
            tg.HapticFeedback.impactOccurred('light');
            updateUI();
        }

        function buyBuilding(id) {
            const cost = getCost(id);
            if (state.gold >= cost) {
                state.gold -= cost;
                state.buildings[id]++;
                tg.HapticFeedback.notificationOccurred('success');
                updateUI();
                saveGame();
            } else {
                tg.HapticFeedback.notificationOccurred('error');
            }
        }

        // --- –û–¢–†–ò–°–û–í–ö–ê (Render) ---
        function updateUI() {
            document.getElementById('gold').innerText = Math.floor(state.gold);
            document.getElementById('income').innerText = `+${calculateIncome()}/—Å–µ–∫`;

            // –†–µ–Ω–¥–µ—Ä —Å–ø–∏—Å–∫–∞ –ø–æ—Å—Ç—Ä–æ–µ–∫ –Ω–∞ –ë–∞–∑–µ
            const baseList = document.getElementById('buildings-list');
            baseList.innerHTML = '';
            gameConfig.buildings.forEach(b => {
                const count = state.buildings[b.id];
                if (count > 0) {
                    baseList.innerHTML += `
                        <div class="card">
                            <div style="display:flex; align-items:center">
                                <span class="building-icon">${b.icon}</span>
                                <div>
                                    <div class="building-name">${b.name}</div>
                                    <div class="building-desc">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: ${count}</div>
                                </div>
                            </div>
                            <div style="font-weight:bold">+${count * b.income}/—Å</div>
                        </div>
                    `;
                }
            });
            if (baseList.innerHTML === '') baseList.innerHTML = '<p style="text-align:center; opacity:0.5">–ü–æ–∫–∞ –ø—É—Å—Ç–æ. –ö—É–ø–∏ —á—Ç–æ-–Ω–∏–±—É–¥—å –≤ –º–∞–≥–∞–∑–∏–Ω–µ!</p>';

            // –†–µ–Ω–¥–µ—Ä –ú–∞–≥–∞–∑–∏–Ω–∞
            const shopList = document.getElementById('shop-list');
            shopList.innerHTML = '';
            gameConfig.buildings.forEach(b => {
                const cost = getCost(b.id);
                const canBuy = state.gold >= cost;
                shopList.innerHTML += `
                    <div class="card">
                        <div style="display:flex; align-items:center">
                            <span class="building-icon">${b.icon}</span>
                            <div>
                                <div class="building-name">${b.name}</div>
                                <div class="building-desc">+${b.income} –∑–æ–ª–æ—Ç–∞/—Å–µ–∫</div>
                            </div>
                        </div>
                        <button class="buy-btn" onclick="buyBuilding('${b.id}')" ${!canBuy ? 'disabled' : ''}>
                            ${cost} üí∞
                        </button>
                    </div>
                `;
            });
        }

        function switchScreen(screenName, btn) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —ç–∫—Ä–∞–Ω—ã
            document.querySelectorAll('.screen').forEach(el => el.classList.remove('active'));
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—ã–π
            document.getElementById(`screen-${screenName}`).classList.add('active');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            btn.classList.add('active');
        }

        // --- –ò–ì–†–û–í–û–ô –¶–ò–ö–õ ---
        setInterval(() => {
            const income = calculateIncome();
            if (income > 0) {
                state.gold += income;
                updateUI();
            }
        }, 1000); // –ö–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É

        // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
        setInterval(saveGame, 5000);

        // –ó–∞–ø—É—Å–∫
        loadGame();

    </script>
</body>
</html>
        .btn {
            background-color: var(--tg-theme-button-color, #007aff);
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            padding: 16px;
            border-radius: 12px;
            width: 100%;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            transition: opacity 0.2s;
        }

        .btn:active { opacity: 0.8; }
        
        .resource-box {
            font-size: 32px;
            font-weight: bold;
            margin: 20px 0;
        }
    </style>
</head>
<body>

    <!-- –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å -->
    <div class="card">
        <h1 id="user-name">–ó–∞–≥—Ä—É–∑–∫–∞...</h1>
        <p id="user-id">ID: ...</p>
    </div>

    <div class="card">
        <p>–¢–≤–æ–∏ —Ä–µ—Å—É—Ä—Å—ã</p>
        <div class="resource-box" id="balance">0 üí∞</div>
        <p>–î–æ–±—ã—á–∞ –≤ —á–∞—Å: 100</p>
    </div>

    <button class="btn" onclick="handleMine()">‚õè –°–æ–±—Ä–∞—Ç—å –Ω–∞–ª–æ–≥–∏</button>

    <!-- –õ–æ–≥–∏–∫–∞ (JavaScript) -->
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        const tg = window.Telegram.WebApp;
        tg.expand(); // –†–∞—Å–∫—Ä—ã—Ç—å –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω

        // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const user = tg.initDataUnsafe.user;
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã –Ω–∞ —ç–∫—Ä–∞–Ω–µ
        const nameEl = document.getElementById('user-name');
        const idEl = document.getElementById('user-id');
        const balanceEl = document.getElementById('balance');

        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
        if (user) {
            nameEl.innerText = `–ü—Ä–∞–≤–∏—Ç–µ–ª—å ${user.first_name}`;
            idEl.innerText = `ID: ${user.id}`;
        } else {
            nameEl.innerText = "–ü—Ä–∞–≤–∏—Ç–µ–ª—å –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π";
            idEl.innerText = "–ó–∞–ø—É—â–µ–Ω–æ –≤–Ω–µ Telegram";
        }

        // –ò–≥—Ä–æ–≤–∞—è –ª–æ–≥–∏–∫–∞
        let balance = 0;

        function handleMine() {
            balance += 10;
            balanceEl.innerText = `${balance} üí∞`;
            
            // –í–∏–±—Ä–∞—Ü–∏—è (—Ç–∞–∫—Ç–∏–ª—å–Ω—ã–π –æ—Ç–∫–ª–∏–∫)
            if (tg.HapticFeedback) {
                tg.HapticFeedback.impactOccurred('medium');
            }
        }

        // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –≥–ª–∞–≤–Ω—É—é –∫–Ω–æ–ø–∫—É (MainButton) –≤–Ω–∏–∑—É —ç–∫—Ä–∞–Ω–∞
        tg.MainButton.setText("–ü–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞–∑–∞—Ä–º—É (500 üí∞)");
        tg.MainButton.show();
        
        tg.MainButton.onClick(() => {
            if (balance >= 500) {
                balance -= 500;
                balanceEl.innerText = `${balance} üí∞`;
                tg.showAlert("–ö–∞–∑–∞—Ä–º–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞!");
            } else {
                tg.showAlert(`–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –∑–æ–ª–æ—Ç–∞! –ù—É–∂–Ω–æ –µ—â–µ ${500 - balance}`);
            }
        });

    </script>
</body>
</html>
